{% load static %}

<html>
	<head>
		<title>Vote</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<script src="https://kit.fontawesome.com/17c066a4d1.js" crossorigin="anonymous"></script>

		<link href="{% static 'styles/fonts.css' %}" rel="stylesheet">
		<link href="{% static 'styles/polls.css' %}" rel="stylesheet">
	</head>
	<body>
		<div class="sidebar">
			<a href="logout" class="logout"><i class="fas fa-sign-out-alt"></i></a>
			<div class="mainInfo">
				<label>{{ user.username }}</label>
				{% if user.gender == 'Masculino' %}
					<img src="{% static 'imgs/defaultMaleIcon.png' %}">
				{% elif user.gender == 'Feminino' %}
					<img src="{% static 'imgs/defaultFemaleIcon.png' %}">
				{% endif %}
			</div>
			<div class="userOptions">
				<div class="userOption">
					<a href="profiles/{{ user.username }}">Perfil</a>
				</div>
				<div class="userOption">
					<a data-bs-toggle="modal" data-bs-target="#addPollModal">Criar enquete</a>
				</div>
				<div class="userOption">
					Amigos 
				</div>
				<div class="userOption">
					Configurações
				</div>
				<div class="userOption">
					Sobre
				</div>
			</div>
		</div>
		<div class="pollsContainer">
			{{ polls }}
		</div>
	</body>

	<div class="modal" tabindex="-1" id="addPollModal">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Nova enquete</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					{% csrf_token %}

					<div class="d-flex flex-row mb-5">
						<label class="me-2">Pergunta:</label>
						<input type="text" id="new_question">
					</div>

					<div class="d-flex flex-row mb-1">
						<label class="me-2">Opção 1:</label>
						<input type="text" id="new_question_op1">
					</div>
					<div class="d-flex flex-row mb-1">
						<label class="me-2">Opção 2:</label>
						<input type="text" id="new_question_op2">
					</div>
					<div class="d-flex flex-row mb-1">
						<label class="me-2">Opção 3:</label>
						<input type="text" id="new_question_op3">
					</div>
					<div class="d-flex flex-row mb-1">
						<label class="me-2">Opção 4:</label>
						<input type="text" id="new_question_op4">
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
					<button type="button" class="btn btn-primary" onclick="save_poll()">Salvar</button>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		function save_poll() {
			form_data = new FormData();
			form_data.append("csrfmiddlewaretoken", document.getElementsByName("csrfmiddlewaretoken")[0].value);
			form_data.append("question", document.getElementById("new_question").value);
			form_data.append("op1", document.getElementById("new_question_op1").value);
			form_data.append("op2", document.getElementById("new_question_op2").value);
			form_data.append("op3", document.getElementById("new_question_op3").value);
			form_data.append("op4", document.getElementById("new_question_op4").value);


			$.ajax({
				url: "save_poll",
				type: "POST",
				data: form_data,
				processData: false,
				contentType: false,
				success: function(result) {
					if(result == "OK") {
						alert("Enquete salva");
						reload_all_polls();
					}
					else {
						alert("Algo deu errado");
					}
				}
			})
		}

		function sendVote(form, option) {
			o = option.id
			form.querySelector('#optionSelected').value = o

			formdata = new FormData(form);

			$.ajax({
				url: "vote",
				type: "POST",
				data: formdata,
			    processData: false,
			    contentType: false,
				success: function(result) {
			    	reload_all_polls();
			 	}
			 });
		}
	</script>
</html>